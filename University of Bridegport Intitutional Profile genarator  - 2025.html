<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>University of Bridgeport - Institutional Profile Generator</title>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">

  <style>
    * { 
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Times New Roman', Georgia, serif;
      background: linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #334155 100%);
      min-height: 100vh;
      padding: 20px;
      color: #1e293b;
      line-height: 1.6;
    }

    .container {
      max-width: 1600px;
      margin: 0 auto;
      background: rgba(255, 255, 255, 0.98);
      border-radius: 24px;
      box-shadow: 0 25px 50px rgba(0, 0, 0, 0.25);
      overflow: hidden;
      backdrop-filter: blur(10px);
      animation: containerSlide 1.2s cubic-bezier(0.4, 0, 0.2, 1);
    }
    
    @keyframes containerSlide {
      from { 
        opacity: 0;
        transform: translateY(50px) scale(0.95);
      }
      to { 
        opacity: 1;
        transform: translateY(0) scale(1);
      }
    }

    .header {
      background: linear-gradient(135deg, #592c82 0%, #00a7e0 50%, #592c82 100%);
      color: white;
      padding: 50px 40px;
      text-align: center;
      position: relative;
      overflow: hidden;
    }
    
    .header::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grid" width="10" height="10" patternUnits="userSpaceOnUse"><path d="M 10 0 L 0 0 0 10" fill="none" stroke="rgba(255,255,255,0.1)" stroke-width="0.5"/></pattern></defs><rect width="100" height="100" fill="url(%23grid)"/></svg>');
      animation: gridMove 30s linear infinite;
    }
    
    @keyframes gridMove { 
      0% { transform: translate(0, 0); }
      100% { transform: translate(10px, 10px); }
    }

    .logo-container {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 20px;
      margin-bottom: 30px;
      position: relative;
      z-index: 2;
    }
    
    .header-subtitle { 
      font-size: 1.2rem;
      font-weight: 400;
      opacity: 0.9;
      position: relative;
      z-index: 2;
    }

    .input-section {
      padding: 50px;
      background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
    }

    .year-section { 
      margin-bottom: 40px;
      text-align: center;
    }
    
    .year-section .form-group { 
      display: inline-block;
      min-width: 300px;
    }
    
    .year-section label {
      font-size: 18px;
      color: #592c82;
      font-weight: 700;
      margin-bottom: 15px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }
    
    .year-section input {
      font-size: 18px !important;
      padding: 18px !important;
      text-align: center;
      font-weight: 700;
      border: 3px solid #00a7e0;
      background: white;
    }

    .input-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
      gap: 25px;
    }
    
    .input-category {
      background: white;
      padding: 30px;
      border-radius: 16px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.06);
      border: 1px solid #e2e8f0;
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    }
    
    .input-category:hover {
      transform: translateY(-8px) scale(1.02);
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.12);
      border-color: #00a7e0;
    }
    
    .category-title {
      font-size: 1.1rem;
      font-weight: 700;
      color: #592c82;
      margin-bottom: 20px;
      display: flex;
      align-items: center;
      gap: 12px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .form-group { 
      margin-bottom: 15px;
    }
    
    .form-group label {
      display: block;
      margin-bottom: 6px;
      font-weight: 600;
      color: #374151;
      font-size: 13px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    
    .form-group input {
      width: 100%;
      padding: 12px 16px;
      border: 2px solid #e5e7eb;
      border-radius: 10px;
      font-size: 14px;
      background: #fafafa;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      font-weight: 500;
      font-family: 'Times New Roman', Georgia, serif;
    }
    
    .form-group input:focus {
      outline: none;
      border-color: #00a7e0;
      background: white;
      box-shadow: 0 0 0 4px rgba(0, 167, 224, 0.1);
      transform: translateY(-1px);
    }
    
    .form-group input.modified {
      color: #00a7e0;
      font-weight: 700;
      border-color: #00a7e0;
      background: #f0f9ff;
      box-shadow: 0 0 0 3px rgba(0, 167, 224, 0.15);
    }

    .generate-btn {
      background: linear-gradient(135deg, #592c82 0%, #00a7e0 50%, #592c82 100%);
      color: white;
      border: none;
      padding: 18px 40px;
      border-radius: 50px;
      font-size: 18px;
      font-weight: 700;
      cursor: pointer;
      margin: 30px auto;
      display: block;
      position: relative;
      overflow: hidden;
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      text-transform: uppercase;
      letter-spacing: 1px;
      font-family: 'Times New Roman', Georgia, serif;
    }
    
    .generate-btn::before {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 0;
      height: 0;
      background: rgba(255, 255, 255, 0.2);
      border-radius: 50%;
      transition: all 0.6s ease;
      transform: translate(-50%, -50%);
    }
    
    .generate-btn:hover::before { 
      width: 300px;
      height: 300px; 
    }
    
    .generate-btn:hover { 
      transform: translateY(-3px);
      box-shadow: 0 20px 40px rgba(89, 44, 130, 0.4);
    }

    .profile-output {
      display: none;
      padding: 50px;
      background: linear-gradient(rgba(255, 255, 255, 0.95), rgba(255, 255, 255, 0.95)),
                  url('https://images.unsplash.com/photo-1541339907198-e08756dedf3f?ixlib=rb-4.0.3&auto=format&fit=crop&w=2000&q=80');
      background-size: cover;
      background-position: center;
      background-attachment: fixed;
      animation: profileFade 1s ease-out;
    }
    
    @keyframes profileFade { 
      from { 
        opacity: 0;
        transform: translateY(30px);
      } 
      to { 
        opacity: 1;
        transform: translateY(0);
      } 
    }

    .profile-header { 
      text-align: center;
      margin-bottom: 60px;
      padding-bottom: 30px;
    }
    
    .academic-year {
      background: linear-gradient(135deg, #592c82 0%, #00a7e0 100%);
      color: white;
      padding: 12px 30px;
      border-radius: 30px;
      font-weight: 700;
      font-size: 18px;
      display: inline-block;
      box-shadow: 0 10px 30px rgba(89, 44, 130, 0.3);
    }

    .infographic-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(450px, 1fr));
      gap: 35px;
      margin-bottom: 50px;
    }
    
    .infographic-card {
      background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
      padding: 35px;
      border-radius: 20px;
      box-shadow: 0 15px 35px rgba(0, 0, 0, 0.08);
      border: 1px solid #e2e8f0;
      transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      overflow: hidden;
    }
    
    .infographic-card::before {
      content: '';
      position: absolute;
      top: 0; 
      left: 0; 
      width: 100%;
      height: 4px;
      background: linear-gradient(90deg, #592c82, #00a7e0, #592c82, #00a7e0, #059669, #dc2626);
    }
    
    .infographic-card:hover { 
      transform: translateY(-12px) scale(1.03);
      box-shadow: 0 25px 50px rgba(0, 0, 0, 0.15);
    }

    .card-title { 
      font-size: 1.4rem;
      font-weight: 800;
      color: #1e293b;
      margin-bottom: 25px;
      display: flex;
      align-items: center;
      gap: 12px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    
    .big-stat {
      font-size: 4rem;
      font-weight: 900;
      text-align: center;
      background: linear-gradient(135deg, #592c82, #00a7e0);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin: 25px 0;
    }

    .stat-grid { 
      display: grid;
      gap: 12px;
    }
    
    .stat-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px 18px;
      background: rgba(248, 250, 252, 0.8);
      border-radius: 12px;
      border-left: 4px solid #592c82;
      transition: all 0.3s ease;
    }
    
    .stat-item:hover { 
      background: white;
      transform: translateX(5px);
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
    }
    
    .stat-label { 
      font-weight: 600;
      color: #475569;
      font-size: 13px;
    }
    
    .stat-value { 
      font-weight: 800;
      color: #1e293b;
      font-size: 16px;
    }
    
    .percentage-value { 
      color: #592c82;
      font-weight: 900;
    }

    .chart-container { 
      position: relative;
      height: 320px;
      margin: 25px 0;
      padding: 20px;
      background: rgba(248, 250, 252, 0.5);
      border-radius: 16px;
      transition: all 0.3s ease;
    }
    
    .chart-container:hover {
      background: rgba(248, 250, 252, 0.9);
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.08);
    }

    .progress-bar-container { 
      margin: 15px 0;
    }
    
    .progress-bar { 
      background: #f1f5f9;
      border-radius: 10px;
      overflow: hidden;
      height: 20px;
      margin-bottom: 8px;
    }
    
    .progress-fill { 
      height: 100%;
      background: linear-gradient(90deg, #592c82, #00a7e0);
      border-radius: 10px;
      transition: width 2s ease-out;
    }
    
    .progress-label { 
      display: flex;
      justify-content: space-between;
      font-size: 12px;
      font-weight: 600;
      color: #64748b;
    }

    .metric-highlight { 
      background: linear-gradient(135deg, rgba(89, 44, 130, 0.1) 0%, rgba(0, 167, 224, 0.1) 100%);
      border: 2px solid #592c82;
      border-radius: 15px;
      padding: 20px;
      margin: 15px 0;
      text-align: center;
    }
    
    .metric-number { 
      font-size: 2.5rem;
      font-weight: 900;
      color: #592c82;
      display: block;
    }
    
    .metric-text { 
      font-size: 14px;
      color: #64748b;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .footnotes-section {
      background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
      margin: 50px 0 30px 0;
      padding: 30px;
      border-radius: 16px;
      border-left: 4px solid #592c82;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
    }
    
    .footnotes-title { 
      font-size: 1.2rem;
      font-weight: 700;
      color: #592c82;
      margin-bottom: 15px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    
    .footnotes-content { 
      display: grid;
      gap: 10px;
    }
    
    .footnote-item { 
      font-size: 13px;
      color: #475569;
      line-height: 1.5;
      font-weight: 500;
      padding: 8px 0;
      border-bottom: 1px solid rgba(148,163,184,0.2);
    }
    
    .footnote-item:last-child { 
      border-bottom: none;
    }

    .action-buttons { 
      display: flex;
      gap: 20px;
      justify-content: center;
      margin: 30px 0;
      flex-wrap: wrap;
    }
    
    .print-btn, .download-btn {
      background: linear-gradient(135deg, #059669 0%, #047857 100%);
      color: white;
      border: none;
      padding: 15px 35px;
      border-radius: 50px;
      font-size: 16px;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.3s ease;
      font-family: 'Times New Roman', Georgia, serif;
    }
    
    .download-btn { 
      background: linear-gradient(135deg, #592c82 0%, #00a7e0 100%);
    }
    
    .print-btn:hover { 
      transform: translateY(-2px);
      box-shadow: 0 10px 25px rgba(5, 150, 105, 0.4);
    }
    
    .download-btn:hover { 
      transform: translateY(-2px);
      box-shadow: 0 10px 25px rgba(89, 44, 130, 0.4);
    }

    .institutional-footer { 
      text-align: center;
      margin-top: 40px;
      padding: 20px;
      border-top: 2px solid #e2e8f0;
      background: rgba(248,250,252,0.8);
      border-radius: 12px;
    }
    
    .institutional-footer p { 
      color: #64748b;
      font-size: 14px;
      font-weight: 500;
      margin: 0;
      line-height: 1.5;
    }

    @media (max-width: 768px) {
      .infographic-grid { 
        grid-template-columns: 1fr;
      }
      
      .input-grid { 
        grid-template-columns: 1fr;
      }
      
      .big-stat { 
        font-size: 3rem;
      }
    }

    @media print {
      .input-section, .generate-btn, .action-buttons { 
        display: none !important;
      }
      
      .profile-output { 
        display: block !important;
      }
      
      body { 
        background: #fff;
      }
      
      .infographic-card, .container {
        box-shadow: none !important;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <div class="logo-container">
        <div style="box-shadow:none; background:white; border-radius:0; width:auto; height:auto;">
          <img src="https://upload.wikimedia.org/wikipedia/commons/5/50/UniversityOfBridgeportLogo.svg" 
               alt="University of Bridgeport Logo" 
               style="height:80px; width:auto; object-fit:contain;">
        </div>
      </div>
      <div class="header-subtitle">Institutional Profile Generator</div>
    </div>

    <div class="input-section">
      <div class="year-section">
        <div class="form-group">
          <label>
            <i class="fas fa-calendar-alt"></i> Academic Year (Required):
          </label>
          <input type="text" id="academicYear" value="2025-2026" required>
        </div>
      </div>

      <div class="input-grid">
        <div class="input-category">
          <div class="category-title">
            <i class="fas fa-graduation-cap"></i> DEGREES
          </div>
          <div class="form-group">
            <label>Degrees conferred (7/1/2023 - 6/30/2024):</label>
            <input type="number" id="degreesConferred" value="1507">
          </div>
        </div>

        <div class="input-category">
          <div class="category-title">
            <i class="fas fa-users"></i> DEMOGRAPHICS (FALL 2024)
          </div>
          <div class="form-group">
            <label>Total enrollment:</label>
            <input type="number" id="totalEnrollment" value="3838">
          </div>
          <div class="form-group">
            <label>CT residents (%):</label>
            <input type="number" id="ctResidents" value="46">
          </div>
          <div class="form-group">
            <label>Part-time (%):</label>
            <input type="number" id="partTime" value="31">
          </div>
          <div class="form-group">
            <label>First-generation (%):</label>
            <input type="number" id="firstGen" value="22">
          </div>
          <div class="form-group">
            <label>Female (%):</label>
            <input type="number" id="female" value="61">
          </div>
          <div class="form-group">
            <label>International (%):</label>
            <input type="number" id="international" value="31">
          </div>
          <div class="form-group">
            <label>Number of countries represented:</label>
            <input type="number" id="countriesRepresented" value="85">
          </div>
          <div class="form-group">
            <label>Amer. Indian-AK Native (%):</label>
            <input type="number" step="0.1" id="raceNative" value="1">
          </div>
          <div class="form-group">
            <label>Asian-Pacific Islander (%):</label>
            <input type="number" step="0.1" id="raceAsianPacific" value="16">
          </div>
          <div class="form-group">
            <label>Black- Non-Hispanic (%):</label>
            <input type="number" step="0.1" id="raceBlack" value="18">
          </div>
          <div class="form-group">
            <label>Hispanic (%):</label>
            <input type="number" step="0.1" id="raceHispanic" value="22">
          </div>
          <div class="form-group">
            <label>No Response (%):</label>
            <input type="number" step="0.1" id="raceNoResponse" value="3">
          </div>
          <div class="form-group">
            <label>Non-Resident Alien (%):</label>
            <input type="number" step="0.1" id="raceNonResidentAlien" value="5">
          </div>
          <div class="form-group">
            <label>Other (%):</label>
            <input type="number" step="0.1" id="raceOther" value="0">
          </div>
          <div class="form-group">
            <label>White-Non-Hispanic (%):</label>
            <input type="number" step="0.1" id="raceWhite" value="35">
          </div>
        </div>

        <div class="input-category">
          <div class="category-title">
            <i class="fas fa-user-plus"></i> NEW STUDENTS (FALL 2024)
          </div>
          <div class="form-group">
            <label>New students:</label>
            <input type="number" id="newStudents" value="1051">
          </div>
          <div class="form-group">
            <label>New transfers-in students (undergraduate):</label>
            <input type="number" id="newTransfers" value="190">
          </div>
          <div class="form-group">
            <label>New first-time students (undergraduate):</label>
            <input type="number" id="newFirstUndergrad" value="372">
          </div>
          <div class="form-group">
            <label>New first-time students (graduate):</label>
            <input type="number" id="newFirstGrad" value="461">
          </div>
        </div>

        <div class="input-category">
          <div class="category-title">
            <i class="fas fa-chart-line"></i> OVERALL RETENTION (FALL 2023 - FALL 2024)
          </div>
          <div class="form-group">
            <label>New transfers-in students (undergraduate) (%):</label>
            <input type="number" id="transferRetention" value="81">
          </div>
          <div class="form-group">
            <label>New first-time students (undergraduate) (%):</label>
            <input type="number" id="undergradRetention" value="59">
          </div>
          <div class="form-group">
            <label>New first-time students (graduate) (%):</label>
            <input type="number" id="gradRetention" value="80">
          </div>
          <div class="form-group">
            <label>New students overall (%):</label>
            <input type="number" id="overallRetention" value="76">
          </div>
        </div>

        <div class="input-category">
          <div class="category-title">
            <i class="fas fa-dollar-sign"></i> FINANCIAL AID & PROGRAMS
          </div>
          <div class="form-group">
            <label>Students receiving any grant or scholarship aid (Fall 2024) (%):</label>
            <input type="number" id="financialAid" value="99">
          </div>
          <div class="form-group">
            <label>All programs:</label>
            <input type="number" id="allPrograms" value="66">
          </div>
          <div class="form-group">
            <label>Associate degree programs:</label>
            <input type="number" id="associatePrograms" value="3">
          </div>
          <div class="form-group">
            <label>Baccalaureate degree programs:</label>
            <input type="number" id="baccalaureatePrograms" value="25">
          </div>
          <div class="form-group">
            <label>Master's degree programs:</label>
            <input type="number" id="mastersPrograms" value="25">
          </div>
          <div class="form-group">
            <label>Doctoral degree programs:</label>
            <input type="number" id="doctoralPrograms" value="6">
          </div>
          <div class="form-group">
            <label>Certificate programs (6th year):</label>
            <input type="number" id="certificatePrograms" value="7">
          </div>
        </div>

        <div class="input-category">
          <div class="category-title">
            <i class="fas fa-chalkboard-teacher"></i> FACULTY & CLASS SIZE
          </div>
          <div class="form-group">
            <label>Full-time faculty:</label>
            <input type="number" id="fullTimeFaculty" value="152">
          </div>
          <div class="form-group">
            <label>Adjunct faculty:</label>
            <input type="number" id="adjunctFaculty" value="266">
          </div>
          <div class="form-group">
            <label>FTE student : FTE faculty ratio:</label>
            <input type="number" id="studentFacultyRatio" value="15">
          </div>
        </div>
      </div>

      <div class="year-section">
        <div class="form-group">
          <label>
            <i class="fas fa-info-circle"></i> Institutional Footer Information:
          </label>
          <input type="text" 
                 id="footerText" 
                 value="Data prepared by the Office of Institutional Effectiveness โข 126 Park Ave, Bridgeport, CT, 06604" 
                 style="width: 100%; max-width: 800px;">
        </div>
      </div>

      <button class="generate-btn" onclick="generateProfile()">
        <i class="fas fa-rocket"></i> Generate Institutional Profile
      </button>
    </div>

    <div class="profile-output" id="profileOutput"></div>
  </div>

  <script>
    let activeCharts = [];
    let currentData = null;

    function destroyCharts() {
      activeCharts.forEach(chart => { 
        if (chart) chart.destroy();
      });
      activeCharts = [];
    }

    function processRaceData(data) {
      const races = [
        { label: 'White-Non-Hispanic', value: parseFloat(data.raceWhite), color: '#592c82' },
        { label: 'Black-Non-Hispanic', value: parseFloat(data.raceBlack), color: '#00a7e0' },
        { label: 'Hispanic', value: parseFloat(data.raceHispanic), color: '#059669' },
        { label: 'Asian-Pacific Islander', value: parseFloat(data.raceAsianPacific), color: '#ea580c' },
        { label: 'Amer. Indian-AK Native', value: parseFloat(data.raceNative), color: '#f59e0b' },
        { label: 'Non-Resident Alien', value: parseFloat(data.raceNonResidentAlien), color: '#10b981' },
        { label: 'No Response', value: parseFloat(data.raceNoResponse), color: '#6366f1' },
        { label: 'Other', value: parseFloat(data.raceOther), color: '#94a3b8' }
      ];
      
      return races.filter(race => race.value > 0).sort((a, b) => b.value - a.value);
    }

    function generateProfile() {
      destroyCharts();

      currentData = {
        academicYear: document.getElementById('academicYear').value,
        footerText: document.getElementById('footerText').value,
        degreesConferred: parseInt(document.getElementById('degreesConferred').value),
        totalEnrollment: parseInt(document.getElementById('totalEnrollment').value),
        ctResidents: parseInt(document.getElementById('ctResidents').value),
        partTime: parseInt(document.getElementById('partTime').value),
        firstGen: parseInt(document.getElementById('firstGen').value),
        female: parseInt(document.getElementById('female').value),
        international: parseInt(document.getElementById('international').value),
        countriesRepresented: parseInt(document.getElementById('countriesRepresented').value),
        raceWhite: document.getElementById('raceWhite').value,
        raceBlack: document.getElementById('raceBlack').value,
        raceHispanic: document.getElementById('raceHispanic').value,
        raceAsianPacific: document.getElementById('raceAsianPacific').value,
        raceNative: document.getElementById('raceNative').value,
        raceNonResidentAlien: document.getElementById('raceNonResidentAlien').value,
        raceNoResponse: document.getElementById('raceNoResponse').value,
        raceOther: document.getElementById('raceOther').value,
        newStudents: parseInt(document.getElementById('newStudents').value),
        newTransfers: parseInt(document.getElementById('newTransfers').value),
        newFirstUndergrad: parseInt(document.getElementById('newFirstUndergrad').value),
        newFirstGrad: parseInt(document.getElementById('newFirstGrad').value),
        transferRetention: parseInt(document.getElementById('transferRetention').value),
        undergradRetention: parseInt(document.getElementById('undergradRetention').value),
        gradRetention: parseInt(document.getElementById('gradRetention').value),
        overallRetention: parseInt(document.getElementById('overallRetention').value),
        financialAid: parseInt(document.getElementById('financialAid').value),
        allPrograms: parseInt(document.getElementById('allPrograms').value),
        associatePrograms: parseInt(document.getElementById('associatePrograms').value),
        baccalaureatePrograms: parseInt(document.getElementById('baccalaureatePrograms').value),
        mastersPrograms: parseInt(document.getElementById('mastersPrograms').value),
        doctoralPrograms: parseInt(document.getElementById('doctoralPrograms').value),
        certificatePrograms: parseInt(document.getElementById('certificatePrograms').value),
        fullTimeFaculty: parseInt(document.getElementById('fullTimeFaculty').value),
        adjunctFaculty: parseInt(document.getElementById('adjunctFaculty').value),
        studentFacultyRatio: parseInt(document.getElementById('studentFacultyRatio').value)
      };

      const totalNew = currentData.newTransfers + currentData.newFirstUndergrad + currentData.newFirstGrad;
      const transferPercent = ((currentData.newTransfers / totalNew) * 100).toFixed(1);
      const undergradPercent = ((currentData.newFirstUndergrad / totalNew) * 100).toFixed(1);
      const gradPercent = ((currentData.newFirstGrad / totalNew) * 100).toFixed(1);

      const profileHTML = `
        <div class="profile-header">
          <div class="logo-container">
            <div style="box-shadow:none; background:none; border-radius:0; width:auto; height:auto;">
              <img src="https://upload.wikimedia.org/wikipedia/commons/5/50/UniversityOfBridgeportLogo.svg" 
                   alt="University of Bridgeport Logo" 
                   style="height:80px; width:auto; object-fit:contain;">
            </div>
          </div>
          <div class="academic-year">INSTITUTIONAL PROFILE ${currentData.academicYear}</div>
        </div>

        <div class="infographic-grid">
          <div class="infographic-card">
            <div class="card-title"><i class="fas fa-chart-bar"></i> Key Metrics</div>
            <div class="big-stat">${currentData.totalEnrollment.toLocaleString()}</div>
            <div style="text-align:center;color:#64748b;font-weight:700;margin-bottom:25px;">TOTAL STUDENTS</div>
            <div class="stat-grid">
              <div class="stat-item">
                <span class="stat-label">Degrees Conferred</span>
                <span class="stat-value">${currentData.degreesConferred.toLocaleString()}</span>
              </div>
              <div class="stat-item">
                <span class="stat-label">New Students (New to institution)</span>
                <span class="stat-value">${currentData.newStudents.toLocaleString()}</span>
              </div>
              <div class="stat-item">
                <span class="stat-label">Financial Aid Recipients</span>
                <span class="stat-value percentage-value">${currentData.financialAid}%</span>
              </div>
              <div class="stat-item">
                <span class="stat-label">Student-Faculty Ratio</span>
                <span class="stat-value">${currentData.studentFacultyRatio}:1</span>
              </div>
            </div>
          </div>

          <div class="infographic-card">
            <div class="card-title"><i class="fas fa-users"></i> Student Demographics</div>
            <div style="margin-bottom: 30px;">
              <h3 style="font-size:1.1rem;font-weight:700;color:#592c82;margin-bottom:15px;text-align:center;">Sex Distribution</h3>
              <div class="chart-container" style="height:200px;">
                <canvas id="genderChart"></canvas>
              </div>
            </div>
            <div>
              <h3 style="font-size:1.1rem;font-weight:700;color:#592c82;margin-bottom:15px;text-align:center;">Race / Ethnicity </h3>
              <div class="chart-container" style="height:280px;">
                <canvas id="ethnicityChart"></canvas>
              </div>
            </div>
          </div>

          <div class="infographic-card">
            <div class="card-title"><i class="fas fa-book"></i> Academic Programs</div>
            <div class="big-stat">${currentData.allPrograms}</div>
            <div style="text-align:center;color:#64748b;font-weight:700;margin-bottom:25px;">TOTAL PROGRAMS</div>
            <div style="display:grid;gap:15px;margin-top:25px;">
              <div style="background:linear-gradient(135deg,rgba(89,44,130,0.1) 0%,rgba(89,44,130,0.05) 100%);padding:20px;border-radius:12px;border-left:4px solid #592c82;display:flex;justify-content:space-between;align-items:center;transition:.3s;cursor:pointer;" onmouseover="this.style.transform='translateX(5px)';this.style.boxShadow='0 5px 15px rgba(89,44,130,0.2)'" onmouseout="this.style.transform='translateX(0)';this.style.boxShadow='none'">
                <div>
                  <div style="font-size:13px;color:#64748b;font-weight:600;text-transform:uppercase;margin-bottom:5px;">Associate Degree</div>
                  <div style="font-size:11px;color:#94a3b8;">Undergraduate Programs</div>
                </div>
                <div style="font-size:2.5rem;font-weight:900;color:#592c82;">${currentData.associatePrograms}</div>
              </div>
              <div style="background:linear-gradient(135deg,rgba(0,167,224,0.1) 0%,rgba(0,167,224,0.05) 100%);padding:20px;border-radius:12px;border-left:4px solid #00a7e0;display:flex;justify-content:space-between;align-items:center;transition:.3s;cursor:pointer;" onmouseover="this.style.transform='translateX(5px)';this.style.boxShadow='0 5px 15px rgba(0,167,224,0.2)'" onmouseout="this.style.transform='translateX(0)';this.style.boxShadow='none'">
                <div>
                  <div style="font-size:13px;color:#64748b;font-weight:600;text-transform:uppercase;margin-bottom:5px;">Baccalaureate Degree</div>
                  <div style="font-size:11px;color:#94a3b8;">Bachelor's Programs</div>
                </div>
                <div style="font-size:2.5rem;font-weight:900;color:#00a7e0;">${currentData.baccalaureatePrograms}</div>
              </div>
              <div style="background:linear-gradient(135deg,rgba(5,150,105,0.1) 0%,rgba(5,150,105,0.05) 100%);padding:20px;border-radius:12px;border-left:4px solid #059669;display:flex;justify-content:space-between;align-items:center;transition:.3s;cursor:pointer;" onmouseover="this.style.transform='translateX(5px)';this.style.boxShadow='0 5px 15px rgba(5,150,105,0.2)'" onmouseout="this.style.transform='translateX(0)';this.style.boxShadow='none'">
                <div>
                  <div style="font-size:13px;color:#64748b;font-weight:600;text-transform:uppercase;margin-bottom:5px;">Master's Degree</div>
                  <div style="font-size:11px;color:#94a3b8;">Graduate Programs</div>
                </div>
                <div style="font-size:2.5rem;font-weight:900;color:#059669;">${currentData.mastersPrograms}</div>
              </div>
              <div style="background:linear-gradient(135deg,rgba(234,88,12,0.1) 0%,rgba(234,88,12,0.05) 100%);padding:20px;border-radius:12px;border-left:4px solid #ea580c;display:flex;justify-content:space-between;align-items:center;transition:.3s;cursor:pointer;" onmouseover="this.style.transform='translateX(5px)';this.style.boxShadow='0 5px 15px rgba(234,88,12,0.2)'" onmouseout="this.style.transform='translateX(0)';this.style.boxShadow='none'">
                <div>
                  <div style="font-size:13px;color:#64748b;font-weight:600;text-transform:uppercase;margin-bottom:5px;">Doctoral Degree</div>
                  <div style="font-size:11px;color:#94a3b8;">PhD Programs</div>
                </div>
                <div style="font-size:2.5rem;font-weight:900;color:#ea580c;">${currentData.doctoralPrograms}</div>
              </div>
              <div style="background:linear-gradient(135deg,rgba(220,38,38,0.1) 0%,rgba(220,38,38,0.05) 100%);padding:20px;border-radius:12px;border-left:4px solid #dc2626;display:flex;justify-content:space-between;align-items:center;transition:.3s;cursor:pointer;" onmouseover="this.style.transform='translateX(5px)';this.style.boxShadow='0 5px 15px rgba(220,38,38,0.2)'" onmouseout="this.style.transform='translateX(0)';this.style.boxShadow='none'">
                <div>
                  <div style="font-size:13px;color:#64748b;font-weight:600;text-transform:uppercase;margin-bottom:5px;">Certificate Programs</div>
                  <div style="font-size:11px;color:#94a3b8;">6th Year Certificates</div>
                </div>
                <div style="font-size:2.5rem;font-weight:900;color:#dc2626;">${currentData.certificatePrograms}</div>
              </div>
            </div>
          </div>

          <div class="infographic-card">
            <div class="card-title"><i class="fas fa-clipboard-list"></i> Enrollment Details</div>
            <div class="progress-bar-container">
              <div class="progress-label"><span>CT Residents</span><span>${currentData.ctResidents}%</span></div>
              <div class="progress-bar"><div class="progress-fill" style="width:${currentData.ctResidents}%"></div></div>
            </div>
            <div class="progress-bar-container">
              <div class="progress-label"><span>International Students</span><span>${currentData.international}%</span></div>
              <div class="progress-bar"><div class="progress-fill" style="width:${currentData.international}%"></div></div>
            </div>
            <div class="progress-bar-container">
              <div class="progress-label"><span>Part-time Students</span><span>${currentData.partTime}%</span></div>
              <div class="progress-bar"><div class="progress-fill" style="width:${currentData.partTime}%"></div></div>
            </div>
            <div class="progress-bar-container">
              <div class="progress-label"><span>First-generation</span><span>${currentData.firstGen}%ยน</span></div>
              <div class="progress-bar"><div class="progress-fill" style="width:${currentData.firstGen}%"></div></div>
            </div>
          </div>

          <div class="infographic-card">
            <div class="card-title"><i class="fas fa-user-plus"></i> New Students Breakdown</div>
            <div class="chart-container"><canvas id="newStudentsChart"></canvas></div>
            <div style="margin-top:20px;padding:15px;background:rgba(248,250,252,0.8);border-radius:12px;">
              <div style="display:grid;gap:10px;">
                <div style="display:flex;justify-content:space-between;align-items:center;">
                  <span style="font-size:13px;font-weight:600;color:#475569;">New Transfers (Undergrad)</span>
                  <span style="font-size:16px;font-weight:800;color:#592c82;">${transferPercent}%</span>
                </div>
                <div style="display:flex;justify-content:space-between;align-items:center;">
                  <span style="font-size:13px;font-weight:600;color:#475569;">New First-time (Undergrad)</span>
                  <span style="font-size:16px;font-weight:800;color:#00a7e0;">${undergradPercent}%</span>
                </div>
                <div style="display:flex;justify-content:space-between;align-items:center;">
                  <span style="font-size:13px;font-weight:600;color:#475569;">New First-time (Graduate)</span>
                  <span style="font-size:16px;font-weight:800;color:#059669;">${gradPercent}%</span>
                </div>
              </div>
            </div>
          </div>

          <div class="infographic-card">
            <div class="card-title"><i class="fas fa-globe"></i> Countries Represented</div>
            <div style="text-align:center;position:relative;padding:40px 20px;">
              <div style="font-size:1.2rem;color:#64748b;font-weight:700;margin-bottom:20px;">STUDENTS FROM</div>
              <div style="font-size:7rem;font-weight:900;background:linear-gradient(45deg,#ff0000 0%,#ff7f00 14%,#ffff00 28%,#00ff00 42%,#0000ff 57%,#4b0082 71%,#9400d3 85%,#ff0000 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;animation:rainbowShift 8s ease-in-out infinite;display:inline-block;padding:0 30px;">${currentData.countriesRepresented}</div>
              <div style="font-size:1.5rem;color:#64748b;font-weight:700;margin-top:10px;letter-spacing:2px;">COUNTRIES</div>
            </div>
            <style>@keyframes rainbowShift{0%,100%{filter:hue-rotate(0deg) brightness(1.2);}50%{filter:hue-rotate(360deg) brightness(1.5);}}</style>
            <div class="metric-highlight" style="margin-top:30px;">
              <span class="metric-number">${currentData.international}%</span>
              <span class="metric-text">International Students</span>
            </div>
          </div>

          <div class="infographic-card">
            <div class="card-title"><i class="fas fa-chart-line"></i> Retention Rates</div>
            <div class="chart-container"><canvas id="retentionChart"></canvas></div>
            <div class="metric-highlight">
              <span class="metric-number">${currentData.overallRetention}%</span>
              <span class="metric-text">Overall Retention Rate</span>
            </div>
          </div>

          <div class="infographic-card">
            <div class="card-title"><i class="fas fa-chalkboard-teacher"></i> Faculty</div>
            <div class="chart-container"><canvas id="facultyChart"></canvas></div>
            <div class="stat-grid">
              <div class="stat-item">
                <span class="stat-label">Full-time Faculty</span>
                <span class="stat-value">${currentData.fullTimeFaculty}</span>
              </div>
              <div class="stat-item">
                <span class="stat-label">Adjunct Faculty</span>
                <span class="stat-value">${currentData.adjunctFaculty}</span>
              </div>
            </div>
            <div class="metric-highlight">
              <span class="metric-number">${currentData.fullTimeFaculty + currentData.adjunctFaculty}</span>
              <span class="metric-text">Total Faculty Members</span>
            </div>
          </div>
        </div>

        <div class="footnotes-section">
          <div class="footnotes-title">Notes:</div>
          <div class="footnotes-content">
            <div class="footnote-item">ยน Calculated based on students who reported at least one parent's education history</div>
          </div>
        </div>

        <div class="institutional-footer">
          <p>${currentData.footerText}</p>
        </div>

        <div class="action-buttons">
          <button class="print-btn" onclick="window.print()">
            <i class="fas fa-print"></i> Print Profile
          </button>
          <button class="download-btn" onclick="downloadProfile()">
            <i class="fas fa-download"></i> Download Institutional Profile
          </button>
        </div>
      `;

      const profileOutputElement = document.getElementById('profileOutput');
      profileOutputElement.innerHTML = profileHTML;
      profileOutputElement.style.display = 'block';

      setTimeout(() => {
        createAllCharts(currentData);
        profileOutputElement.scrollIntoView({ behavior: 'smooth' });
      }, 200);
    }

    function createAllCharts(data) {
      const ubColors = ['#592c82', '#00a7e0', '#059669', '#ea580c', '#dc2626', '#f59e0b', '#10b981', '#6366f1'];

      const malePercent = 100 - data.female;
      const genderCtx = document.getElementById('genderChart').getContext('2d');
      const genderChart = new Chart(genderCtx, {
        type: 'doughnut',
        data: { 
          labels: ['Female','Male'],
          datasets: [{
            data: [data.female, malePercent],
            backgroundColor: [ubColors[0], ubColors[1]],
            borderWidth: 0,
            hoverOffset: 20,
            hoverBorderWidth: 4,
            hoverBorderColor: '#ffffff'
          }] 
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              position: 'bottom', 
              labels: {
                padding: 15, 
                font: {size: 12, weight: 'bold'}, 
                color: '#374151',
                usePointStyle: true,
                pointStyle: 'circle'
              }
            },
            tooltip: {
              enabled: true,
              backgroundColor: 'rgba(0, 0, 0, 0.9)',
              titleColor: '#ffffff',
              bodyColor: '#ffffff',
              titleFont: {size: 14, weight: 'bold'},
              bodyFont: {size: 13},
              padding: 15,
              displayColors: true,
              borderColor: '#ffffff',
              borderWidth: 2,
              callbacks: {
                label: (context) => `${context.label}: ${context.parsed}% of students`
              }
            }
          },
          animation: {animateRotate: true, duration: 2000}
        }
      });
      activeCharts.push(genderChart);

      const processedRaces = processRaceData(data);
      const ethnicityCtx = document.getElementById('ethnicityChart').getContext('2d');
      const ethnicityChart = new Chart(ethnicityCtx, {
        type: 'doughnut',
        data: {
          labels: processedRaces.map(item => item.label),
          datasets: [{
            data: processedRaces.map(item => item.value),
            backgroundColor: processedRaces.map(item => item.color),
            borderWidth: 3,
            borderColor: '#ffffff',
            hoverOffset: 25,
            hoverBorderWidth: 5,
            hoverBorderColor: '#ffffff'
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              position: 'right',
              labels: {
                padding: 15,
                font: {size: 11, weight: 'bold'},
                color: '#374151',
                usePointStyle: true,
                pointStyle: 'circle',
                generateLabels: (chart) => chart.data.labels.map((label, index) => ({
                  text: `${label}: ${chart.data.datasets[0].data[index]}%`,
                  fillStyle: chart.data.datasets[0].backgroundColor[index],
                  hidden: false, 
                  index: index
                }))
              }
            },
            tooltip: {
              enabled: true,
              backgroundColor: 'rgba(0, 0, 0, 0.9)',
              titleColor: '#ffffff',
              bodyColor: '#ffffff',
              titleFont: {size: 14, weight: 'bold'},
              bodyFont: {size: 13},
              padding: 15,
              displayColors: true,
              borderColor: '#ffffff',
              borderWidth: 2,
              callbacks: {
                label: (context) => `${context.label}: ${context.parsed}% of students`
              }
            }
          },
          animation: {animateRotate: true, animateScale: true, duration: 2000}
        }
      });
      activeCharts.push(ethnicityChart);

      const totalNew = data.newTransfers + data.newFirstUndergrad + data.newFirstGrad;
      const newStudentsCtx = document.getElementById('newStudentsChart').getContext('2d');
      const newStudentsChart = new Chart(newStudentsCtx, {
        type: 'pie',
        data: {
          labels: ['New Transfers (Undergrad)','New First-time (Undergrad)','New First-time (Graduate)'],
          datasets: [{
            data: [data.newTransfers, data.newFirstUndergrad, data.newFirstGrad],
            backgroundColor: ['#592c82','#00a7e0','#059669'],
            borderWidth: 0,
            hoverOffset: 20,
            hoverBorderWidth: 4,
            hoverBorderColor: '#ffffff'
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {display: false},
            tooltip: {
              enabled: true,
              backgroundColor: 'rgba(0, 0, 0, 0.9)',
              titleColor: '#ffffff',
              bodyColor: '#ffffff',
              titleFont: {size: 14, weight: 'bold'},
              bodyFont: {size: 13},
              padding: 15,
              displayColors: true,
              borderColor: '#ffffff',
              borderWidth: 2,
              callbacks: {
                label: (context) => {
                  const percentage = ((context.parsed / totalNew) * 100).toFixed(1);
                  return `${context.label}: ${context.parsed} students (${percentage}%)`;
                }
              }
            }
          },
          animation: {animateRotate: true, duration: 1800}
        }
      });
      activeCharts.push(newStudentsChart);

      const retentionCtx = document.getElementById('retentionChart').getContext('2d');
      const retentionChart = new Chart(retentionCtx, {
        type: 'bar',
        data: {
          labels: ['Transfer\nRetention','Undergrad\nRetention','Graduate\nRetention','Overall\nRetention'],
          datasets: [{
            label: 'Retention Rate',
            data: [data.transferRetention, data.undergradRetention, data.gradRetention, data.overallRetention],
            backgroundColor: [ubColors[0], ubColors[1], ubColors[2], ubColors[3]],
            borderRadius: 8,
            borderSkipped: false,
            hoverBackgroundColor: ['rgba(89, 44, 130, 0.8)', 'rgba(0, 167, 224, 0.8)', 'rgba(5, 150, 105, 0.8)', 'rgba(234, 88, 12, 0.8)']
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {display: false},
            tooltip: {
              enabled: true,
              backgroundColor: 'rgba(0, 0, 0, 0.9)',
              titleColor: '#ffffff',
              bodyColor: '#ffffff',
              titleFont: {size: 14, weight: 'bold'},
              bodyFont: {size: 13},
              padding: 15,
              displayColors: true,
              borderColor: '#ffffff',
              borderWidth: 2,
              callbacks: {
                label: (context) => `Retention Rate: ${context.parsed.y}%`,
                afterLabel: () => 'of students returned'
              }
            }
          },
          scales: {
            y: {
              beginAtZero: true,
              max: 100,
              ticks: {
                font: {weight: 'bold'}, 
                color: '#374151',
                callback: (value) => value + '%'
              }, 
              grid: {color: '#f1f5f9'}
            },
            x: {
              ticks: {
                font: {weight: 'bold', size: 10}, 
                color: '#374151'
              }, 
              grid: {display: false}
            }
          },
          animation: {
            duration: 2000, 
            easing: 'easeInOutQuart',
            onComplete: function() {
              const chartInstance = this;
              const ctx = chartInstance.ctx;
              ctx.font = 'bold 16px "Times New Roman"'; 
              ctx.fillStyle = '#1e293b'; 
              ctx.textAlign = 'center'; 
              ctx.textBaseline = 'bottom';
              this.data.datasets.forEach((dataset, datasetIndex) => {
                const meta = chartInstance.getDatasetMeta(datasetIndex);
                meta.data.forEach((bar, index) => {
                  ctx.fillText(dataset.data[index] + '%', bar.x, bar.y - 8);
                });
              });
            }
          }
        }
      });
      activeCharts.push(retentionChart);

      const facultyCtx = document.getElementById('facultyChart').getContext('2d');
      const facultyChart = new Chart(facultyCtx, {
        type: 'doughnut',
        data: {
          labels: ['Full-time Faculty','Adjunct Faculty'],
          datasets: [{
            data: [data.fullTimeFaculty, data.adjunctFaculty],
            backgroundColor: ['#592c82','#00a7e0'],
            borderWidth: 0,
            hoverOffset: 20,
            hoverBorderWidth: 4,
            hoverBorderColor: '#ffffff'
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              position: 'bottom',
              labels: {
                padding: 20, 
                font: {size: 12, weight: 'bold'}, 
                color: '#374151',
                usePointStyle: true,
                pointStyle: 'circle'
              }
            },
            tooltip: {
              enabled: true,
              backgroundColor: 'rgba(0, 0, 0, 0.9)',
              titleColor: '#ffffff',
              bodyColor: '#ffffff',
              titleFont: {size: 14, weight: 'bold'},
              bodyFont: {size: 13},
              padding: 15,
              displayColors: true,
              borderColor: '#ffffff',
              borderWidth: 2,
              callbacks: {
                label: (context) => {
                  const total = data.fullTimeFaculty + data.adjunctFaculty;
                  const percentage = ((context.parsed / total) * 100).toFixed(1);
                  return `${context.label}: ${context.parsed} (${percentage}%)`;
                }
              }
            }
          },
          animation: {animateRotate: true, duration: 2000}
        }
      });
      activeCharts.push(facultyChart);
    }

    function downloadProfile() {
      if (!currentData) {
        alert('Please generate the profile first.');
        return;
      }

      const profile = document.getElementById('profileOutput');
      const clone = profile.cloneNode(true);
      const actions = clone.querySelector('.action-buttons');
      if (actions) actions.remove();

      const canvases = clone.querySelectorAll('canvas');
      canvases.forEach(canvas => {
        const newCanvas = document.createElement('canvas');
        newCanvas.id = canvas.id;
        canvas.parentNode.replaceChild(newCanvas, canvas);
      });

      const year = (currentData.academicYear || 'Profile').replace(/[^\w-]+/g, '_');

      const htmlDoc = `<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>UB Profile ${year}</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"><\/script>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
<style>
*{margin:0;padding:0;box-sizing:border-box;}
body{font-family:'Times New Roman',Georgia,serif;background:#fff;padding:20px;color:#1e293b;line-height:1.6;}
.container{max-width:1600px;margin:0 auto;background:#fff;}
.profile-output{display:block!important;padding:50px;background:#fff;}
.profile-header{text-align:center;margin-bottom:60px;padding-bottom:30px;}
.logo-container{display:flex;align-items:center;justify-content:center;gap:20px;margin-bottom:30px;}
.academic-year{background:linear-gradient(135deg,#592c82 0%,#00a7e0 100%);color:white;padding:12px 30px;border-radius:30px;font-weight:700;font-size:18px;display:inline-block;box-shadow:0 10px 30px rgba(89,44,130,0.3);}
.infographic-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(450px,1fr));gap:35px;margin-bottom:50px;}
.infographic-card{background:linear-gradient(135deg,#ffffff 0%,#f8fafc 100%);padding:35px;border-radius:20px;box-shadow:0 15px 35px rgba(0,0,0,0.08);border:1px solid #e2e8f0;transition:all 0.5s;position:relative;overflow:hidden;}
.infographic-card::before{content:'';position:absolute;top:0;left:0;width:100%;height:4px;background:linear-gradient(90deg,#592c82,#00a7e0,#592c82,#00a7e0,#059669,#dc2626);}
.infographic-card:hover{transform:translateY(-12px) scale(1.03);box-shadow:0 25px 50px rgba(0,0,0,0.15);}
.card-title{font-size:1.4rem;font-weight:800;color:#1e293b;margin-bottom:25px;display:flex;align-items:center;gap:12px;text-transform:uppercase;letter-spacing:0.5px;}
.big-stat{font-size:4rem;font-weight:900;text-align:center;background:linear-gradient(135deg,#592c82,#00a7e0);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;margin:25px 0;}
.stat-grid{display:grid;gap:12px;}
.stat-item{display:flex;justify-content:space-between;align-items:center;padding:12px 18px;background:rgba(248,250,252,0.8);border-radius:12px;border-left:4px solid #592c82;transition:all 0.3s ease;}
.stat-item:hover{background:white;transform:translateX(5px);box-shadow:0 5px 15px rgba(0,0,0,0.1);}
.stat-label{font-weight:600;color:#475569;font-size:13px;}
.stat-value{font-weight:800;color:#1e293b;font-size:16px;}
.percentage-value{color:#592c82;font-weight:900;}
.chart-container{position:relative;height:320px;margin:25px 0;padding:20px;background:rgba(248,250,252,0.5);border-radius:16px;transition:all 0.3s ease;}
.chart-container:hover{background:rgba(248,250,252,0.9);box-shadow:0 8px 20px rgba(0,0,0,0.08);}
.progress-bar-container{margin:15px 0;}
.progress-bar{background:#f1f5f9;border-radius:10px;overflow:hidden;height:20px;margin-bottom:8px;}
.progress-fill{height:100%;background:linear-gradient(90deg,#592c82,#00a7e0);border-radius:10px;transition:width 2s ease-out;}
.progress-label{display:flex;justify-content:space-between;font-size:12px;font-weight:600;color:#64748b;}
.metric-highlight{background:linear-gradient(135deg,rgba(89,44,130,0.1) 0%,rgba(0,167,224,0.1) 100%);border:2px solid #592c82;border-radius:15px;padding:20px;margin:15px 0;text-align:center;}
.metric-number{font-size:2.5rem;font-weight:900;color:#592c82;display:block;}
.metric-text{font-size:14px;color:#64748b;font-weight:600;text-transform:uppercase;letter-spacing:0.5px;}
.footnotes-section{background:linear-gradient(135deg,#f8fafc 0%,#f1f5f9 100%);margin:50px 0 30px 0;padding:30px;border-radius:16px;border-left:4px solid #592c82;box-shadow:0 4px 15px rgba(0,0,0,0.05);}
.footnotes-title{font-size:1.2rem;font-weight:700;color:#592c82;margin-bottom:15px;text-transform:uppercase;letter-spacing:0.5px;}
.footnotes-content{display:grid;gap:10px;}
.footnote-item{font-size:13px;color:#475569;line-height:1.5;font-weight:500;padding:8px 0;border-bottom:1px solid rgba(148,163,184,0.2);}
.footnote-item:last-child{border-bottom:none;}
.institutional-footer{text-align:center;margin-top:40px;padding:20px;border-top:2px solid #e2e8f0;background:rgba(248,250,252,0.8);border-radius:12px;}
.institutional-footer p{color:#64748b;font-size:14px;font-weight:500;margin:0;line-height:1.5;}
@keyframes rainbowShift{0%,100%{filter:hue-rotate(0deg) brightness(1.2);}50%{filter:hue-rotate(360deg) brightness(1.5);}}
@media (max-width:768px){.infographic-grid{grid-template-columns:1fr;}.big-stat{font-size:3rem;}}
</style>
</head>
<body>
<div class="container">
${clone.outerHTML}
</div>
<script>
const data={female:${currentData.female},male:${100-currentData.female},raceWhite:${currentData.raceWhite},raceBlack:${currentData.raceBlack},raceHispanic:${currentData.raceHispanic},raceAsianPacific:${currentData.raceAsianPacific},raceNative:${currentData.raceNative},raceNonResidentAlien:${currentData.raceNonResidentAlien},raceNoResponse:${currentData.raceNoResponse},raceOther:${currentData.raceOther},newTransfers:${currentData.newTransfers},newFirstUndergrad:${currentData.newFirstUndergrad},newFirstGrad:${currentData.newFirstGrad},transferRetention:${currentData.transferRetention},undergradRetention:${currentData.undergradRetention},gradRetention:${currentData.gradRetention},overallRetention:${currentData.overallRetention},fullTimeFaculty:${currentData.fullTimeFaculty},adjunctFaculty:${currentData.adjunctFaculty}};

function processRaceData(d){
  const races=[
    {label:'White-Non-Hispanic',value:parseFloat(d.raceWhite),color:'#592c82'},
    {label:'Black-Non-Hispanic',value:parseFloat(d.raceBlack),color:'#00a7e0'},
    {label:'Hispanic',value:parseFloat(d.raceHispanic),color:'#059669'},
    {label:'Asian-Pacific Islander',value:parseFloat(d.raceAsianPacific),color:'#ea580c'},
    {label:'Amer. Indian-AK Native',value:parseFloat(d.raceNative),color:'#f59e0b'},
    {label:'Non-Resident Alien',value:parseFloat(d.raceNonResidentAlien),color:'#10b981'},
    {label:'No Response',value:parseFloat(d.raceNoResponse),color:'#6366f1'},
    {label:'Other',value:parseFloat(d.raceOther),color:'#94a3b8'}
  ];
  return races.filter(r=>r.value>0).sort((a,b)=>b.value-a.value);
}

function initCharts(){
  const ubColors=['#592c82','#00a7e0','#059669','#ea580c','#dc2626','#f59e0b','#10b981','#6366f1'];
  
  const genderCtx=document.getElementById('genderChart');
  if(genderCtx){
    new Chart(genderCtx.getContext('2d'),{
      type:'doughnut',
      data:{
        labels:['Female','Male'],
        datasets:[{
          data:[data.female,data.male],
          backgroundColor:[ubColors[0],ubColors[1]],
          borderWidth:0,
          hoverOffset:20,
          hoverBorderWidth:4,
          hoverBorderColor:'#ffffff'
        }]
      },
      options:{
        responsive:true,
        maintainAspectRatio:false,
        plugins:{
          legend:{
            position:'bottom',
            labels:{
              padding:15,
              font:{size:12,weight:'bold'},
              color:'#374151',
              usePointStyle:true,
              pointStyle:'circle'
            }
          },
          tooltip:{
            enabled:true,
            backgroundColor:'rgba(0,0,0,0.9)',
            titleColor:'#ffffff',
            bodyColor:'#ffffff',
            titleFont:{size:14,weight:'bold'},
            bodyFont:{size:13},
            padding:15,
            displayColors:true,
            borderColor:'#ffffff',
            borderWidth:2,
            callbacks:{
              label:(ctx)=>\`\${ctx.label}: \${ctx.parsed}% of students\`
            }
          }
        },
        animation:{animateRotate:true,duration:2000}
      }
    });
  }
  
  const processedRaces=processRaceData(data);
  const ethnicityCtx=document.getElementById('ethnicityChart');
  if(ethnicityCtx){
    new Chart(ethnicityCtx.getContext('2d'),{
      type:'doughnut',
      data:{
        labels:processedRaces.map(i=>i.label),
        datasets:[{
          data:processedRaces.map(i=>i.value),
          backgroundColor:processedRaces.map(i=>i.color),
          borderWidth:3,
          borderColor:'#ffffff',
          hoverOffset:25,
          hoverBorderWidth:5,
          hoverBorderColor:'#ffffff'
        }]
      },
      options:{
        responsive:true,
        maintainAspectRatio:false,
        plugins:{
          legend:{
            position:'right',
            labels:{
              padding:15,
              font:{size:11,weight:'bold'},
              color:'#374151',
              usePointStyle:true,
              pointStyle:'circle',
              generateLabels:(chart)=>chart.data.labels.map((l,i)=>({
                text:\`\${l}: \${chart.data.datasets[0].data[i]}%\`,
                fillStyle:chart.data.datasets[0].backgroundColor[i],
                hidden:false,
                index:i
              }))
            }
          },
          tooltip:{
            enabled:true,
            backgroundColor:'rgba(0,0,0,0.9)',
            titleColor:'#ffffff',
            bodyColor:'#ffffff',
            titleFont:{size:14,weight:'bold'},
            bodyFont:{size:13},
            padding:15,
            displayColors:true,
            borderColor:'#ffffff',
            borderWidth:2,
            callbacks:{
              label:(ctx)=>\`\${ctx.label}: \${ctx.parsed}% of students\`
            }
          }
        },
        animation:{animateRotate:true,animateScale:true,duration:2000}
      }
    });
  }
  
  const totalNew=data.newTransfers+data.newFirstUndergrad+data.newFirstGrad;
  const newStudentsCtx=document.getElementById('newStudentsChart');
  if(newStudentsCtx){
    new Chart(newStudentsCtx.getContext('2d'),{
      type:'pie',
      data:{
        labels:['New Transfers (Undergrad)','New First-time (Undergrad)','New First-time (Graduate)'],
        datasets:[{
          data:[data.newTransfers,data.newFirstUndergrad,data.newFirstGrad],
          backgroundColor:['#592c82','#00a7e0','#059669'],
          borderWidth:0,
          hoverOffset:20,
          hoverBorderWidth:4,
          hoverBorderColor:'#ffffff'
        }]
      },
      options:{
        responsive:true,
        maintainAspectRatio:false,
        plugins:{
          legend:{display:false},
          tooltip:{
            enabled:true,
            backgroundColor:'rgba(0,0,0,0.9)',
            titleColor:'#ffffff',
            bodyColor:'#ffffff',
            titleFont:{size:14,weight:'bold'},
            bodyFont:{size:13},
            padding:15,
            displayColors:true,
            borderColor:'#ffffff',
            borderWidth:2,
            callbacks:{
              label:(ctx)=>{
                const pct=((ctx.parsed/totalNew)*100).toFixed(1);
                return\`\${ctx.label}: \${ctx.parsed} students (\${pct}%)\`;
              }
            }
          }
        },
        animation:{animateRotate:true,duration:1800}
      }
    });
  }
  
  const retentionCtx=document.getElementById('retentionChart');
  if(retentionCtx){
    new Chart(retentionCtx.getContext('2d'),{
      type:'bar',
      data:{
        labels:['Transfer\\nRetention','Undergrad\\nRetention','Graduate\\nRetention','Overall\\nRetention'],
        datasets:[{
          label:'Retention Rate',
          data:[data.transferRetention,data.undergradRetention,data.gradRetention,data.overallRetention],
          backgroundColor:[ubColors[0],ubColors[1],ubColors[2],ubColors[3]],
          borderRadius:8,
          borderSkipped:false,
          hoverBackgroundColor:['rgba(89,44,130,0.8)','rgba(0,167,224,0.8)','rgba(5,150,105,0.8)','rgba(234,88,12,0.8)']
        }]
      },
      options:{
        responsive:true,
        maintainAspectRatio:false,
        plugins:{
          legend:{display:false},
          tooltip:{
            enabled:true,
            backgroundColor:'rgba(0,0,0,0.9)',
            titleColor:'#ffffff',
            bodyColor:'#ffffff',
            titleFont:{size:14,weight:'bold'},
            bodyFont:{size:13},
            padding:15,
            displayColors:true,
            borderColor:'#ffffff',
            borderWidth:2,
            callbacks:{
              label:(ctx)=>\`Retention Rate: \${ctx.parsed.y}%\`,
              afterLabel:()=>'of students returned'
            }
          }
        },
        scales:{
          y:{
            beginAtZero:true,
            max:100,
            ticks:{
              font:{weight:'bold'},
              color:'#374151',
              callback:(v)=>v+'%'
            },
            grid:{color:'#f1f5f9'}
          },
          x:{
            ticks:{
              font:{weight:'bold',size:10},
              color:'#374151'
            },
            grid:{display:false}
          }
        },
        animation:{
          duration:2000,
          easing:'easeInOutQuart',
          onComplete:function(){
            const ci=this;
            const ctx=ci.ctx;
            ctx.font='bold 16px "Times New Roman"';
            ctx.fillStyle='#1e293b';
            ctx.textAlign='center';
            ctx.textBaseline='bottom';
            this.data.datasets.forEach((ds,i)=>{
              const meta=ci.getDatasetMeta(i);
              meta.data.forEach((bar,idx)=>{
                ctx.fillText(ds.data[idx]+'%',bar.x,bar.y-8);
              });
            });
          }
        }
      }
    });
  }
  
  const facultyCtx=document.getElementById('facultyChart');
  if(facultyCtx){
    new Chart(facultyCtx.getContext('2d'),{
      type:'doughnut',
      data:{
        labels:['Full-time Faculty','Adjunct Faculty'],
        datasets:[{
          data:[data.fullTimeFaculty,data.adjunctFaculty],
          backgroundColor:['#592c82','#00a7e0'],
          borderWidth:0,
          hoverOffset:20,
          hoverBorderWidth:4,
          hoverBorderColor:'#ffffff'
        }]
      },
      options:{
        responsive:true,
        maintainAspectRatio:false,
        plugins:{
          legend:{
            position:'bottom',
            labels:{
              padding:20,
              font:{size:12,weight:'bold'},
              color:'#374151',
              usePointStyle:true,
              pointStyle:'circle'
            }
          },
          tooltip:{
            enabled:true,
            backgroundColor:'rgba(0,0,0,0.9)',
            titleColor:'#ffffff',
            bodyColor:'#ffffff',
            titleFont:{size:14,weight:'bold'},
            bodyFont:{size:13},
            padding:15,
            displayColors:true,
            borderColor:'#ffffff',
            borderWidth:2,
            callbacks:{
              label:(ctx)=>{
                const total=data.fullTimeFaculty+data.adjunctFaculty;
                const pct=((ctx.parsed/total)*100).toFixed(1);
                return\`\${ctx.label}: \${ctx.parsed} (\${pct}%)\`;
              }
            }
          }
        },
        animation:{animateRotate:true,duration:2000}
      }
    });
  }
}

if(document.readyState==='loading'){
  document.addEventListener('DOMContentLoaded',initCharts);
}else{
  if(typeof Chart!=='undefined'){
    initCharts();
  }else{
    window.addEventListener('load',initCharts);
  }
}
<\/script>
</body>
</html>`;

      const blob = new Blob([htmlDoc], { type: 'text/html' });
      const url = URL.createObjectURL(blob);
      const link = document.createElement('a');
      link.href = url;
      link.download = `UBIP2025_${year}.html`;
      document.body.appendChild(link);
      link.click();
      URL.revokeObjectURL(url);
      link.remove();
    }

    document.addEventListener('DOMContentLoaded', function() {
      const inputs = document.querySelectorAll('input');
      const originalValues = new Map();

      inputs.forEach(input => {
        originalValues.set(input.id, input.value);

        input.addEventListener('focus', function() {
          this.parentElement.style.transform = 'translateY(-2px)';
          this.parentElement.style.transition = 'transform 0.3s ease';
        });

        input.addEventListener('blur', function() {
          this.parentElement.style.transform = 'translateY(0)';
        });
        
        input.addEventListener('input', function() {
          const originalValue = originalValues.get(this.id);
          this.classList.toggle('modified', this.value !== originalValue);
        });
        
        input.addEventListener('change', function() {
          const originalValue = originalValues.get(this.id);
          this.classList.toggle('modified', this.value !== originalValue);
        });
      });
    });
  </script>
</body>
</html>